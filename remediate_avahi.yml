---
# Red Hat Insights has recommended one or more actions for you, a system administrator, to review and if you
# deem appropriate, deploy on your systems running Red Hat software. Based on the analysis, we have automatically
# generated an Ansible Playbook for you. Please review and test the recommended actions and the Playbook as
# they may contain configuration changes, updates, reboots and/or other changes to your systems. Red Hat is not
# responsible for any adverse outcomes related to these recommendations or Playbooks.
#
# RHSA-2022:0951
# https://console.redhat.com/insights/remediations/a8a17fc8-c30b-4703-a67a-678e53158cd9
# Generated by Red Hat Insights on Tue, 22 Mar 2022 15:23:15 GMT
# Created by daramire@redhat.com

# Apply RHSA-2022:0951
# Identifier: (patch-advisory:RHSA-2022:0951,fix)
# Version: unknown
- name: update packages
  hosts: "all"
  vars:
    insights_issues: "--advisory RHSA-2022:0951"
    requires_reboot: "false"
    insights_signature_exclude: "/hosts,/vars/insights_signature,/vars/insights_issues,/vars/requires_reboot"
    insights_signature: !!binary |
      TFMwdExTMUNSVWRKVGlCUVIxQWdVMGxIVGtGVVZWSkZMUzB0TFMwS1ZtVnljMmx2YmpvZ1IyNTFV
      RWNnZGpFS0NtbFJTVlpCZDFWQldWaEVNVEE0ZG5jMU9FUXJhalZ3VGtGUmFTdDVRUzg1UmpKck0y
      RjFNaXN6YWpBdmRVNXJMek5FZVRRclJrRXdXWGREY0Zsd05pOEtOSGQxYUZKRk1IUkpZVWhvWVdK
      aU9VRndlR1JzUjBnNFVtWXJWSFJ3Vm1aR2J6WmpWbVJNVml0clJqSnZLelZKVDNjd1JHaGplVFJS
      VTNCdmJEUjBTQXB4VDI1amMyWjJNelJ2VGxGVk5rUmxjMjA0UkZCbGJURlJZWEJhYm01bVlrdExZ
      MU5uUW00clpsRjVPSEprZVVSR2VrcG9RMGMxWVVwb1VsY3pWR2d2Q2xFelRGVTNNbFJxWVVWSWMy
      STVRM2h5TlZaamFuUnJkMWczYzFWSGFFWkRkM05FVEVKSVJFVnJiMjk0UzA5TWVVRjRWbTB4ZEVs
      T1RGaHdWa3hKTkdvS2Eya3llVXRHZERkYVpERjZPRWc0WVc1bFJsSmpUMmR1T0c1cGVGQnBRMDE2
      YjBwMVkxbHdUMVpYTjNVMk1tMDVXVWhxVUZkRE9YUnBLMWhSUlRNNUx3cFpXR1pYVlVWVU5GaE1k
      ekZyYldkYVRFMDNkMUl5UkdkaVVXWXdOMVU1WkU5TVdFSnZNRzF5WVZaVFFUTmxZVFZ6U2xKc2RH
      bEJhVGxRTlhVemRGSnNDa2xzVTNGNmF6ZHpNMHRHTmpCNGJFWkVSVmwyTmpOb2FVdHRaM3BLZUVk
      NlptdzBNVEZyVWxKdlVVbzJTRVI0UjBGTFFVZG5OMlkzWTFSUlRWTlpjRTRLTUU1TFZubFZPVmRV
      ZFdkWmRXTjZhRk5vWVRGSFpsUXpiMFp3UjBGV05HaG1TSFpEYlRkUE9ESmtiQzhyZERSSGVsbEtO
      VmxPUkZoNVkwb3lPVTR6U1FwbldsUlRPRVJTVFZOSFJFaE9ha1J0UlZnNVdYRm1halkxVFhkS1Vr
      UkdVa3hNTjFaV1EzQktOa1ZQWlRSQ1VHdFJSbFp2UzI1aVJtaDNTbWg1VW1ScENuSjRTelJ1YnpS
      ME9GYzNlRFpIZVN0VVIzcDZSMVJ4UWxJMUsxZHROVzlLWVZoU1ptNXNkbmRtVGt0NU5HaDFObUZM
      ZVVOWVlUWnNLMFY1ZDNWd2VVb0tNSEZ2TjBKWVVsTnlNM3BqWjJjdmJXb3hjSGRKY0ZwcE1HSnlO
      elpRUWt3cmEzSk1TVVpKYjJKVU4xcEVkR1ptZGpCQk5VNTFNV05xZHpnMVZuUTFkQXB4TlZCcFpF
      cGpUMDFDTUQwS1BXbE9UemtLTFMwdExTMUZUa1FnVUVkUUlGTkpSMDVCVkZWU1JTMHRMUzB0Q2c9
      PQ==
  become: true
  tasks:
    - name: check for update
      shell: "{{ ansible_facts['pkg_mgr'] }} check-update -q {{ insights_issues | regex_search('(--advisory ((FEDORA-EPEL-[\\w-]+)|(RH[SBE]A-20[\\d]{2}:[\\d]{4,5}))\\s*)+') }}"
      check_mode: no
      register: check_out
      failed_when: check_out.rc != 0 and check_out.rc != 100
      args:
        warn: false

    - when: check_out.rc == 100
      name: upgrade package
      shell: "{{ ansible_facts['pkg_mgr'] }} update -d 2 -y {{ insights_issues | regex_search('(--advisory ((FEDORA-EPEL-[\\w-]+)|(RH[SBE]A-20[\\d]{2}:[\\d]{4,5}))\\s*)+') }}"
      args:
        warn: false

    - when: check_out.rc == 100
      name: set reboot fact
      set_fact:
        insights_needs_reboot: "{{requires_reboot}}"

- name: run insights
  hosts: "a45b41667677c5e8ba05e64e446114e106c4c326.example.com,a4d760ca71c280e1b723e2a2d11b65e27d57cc67.example.com,aap.controller,aap.demo.kjz.dev,aap.localdomain,aap2,aap2.hub,aapdb.vm.bdm.scot,acm-ansbile-controller.hosts.prod.psi.rdu2.redhat.com,acm-cee-labs-05.cee.ral3.lab.eng.rdu2.redhat.com,akagera.mihalabo.com,amazing.iot-playground.org,amq1.heytate.com,ansible-ws,ansible.demolab.com,ansible.lab.kjz.dev,ansible1.heytate.com,auth.demo.kjz.dev,awesome.iot-playground.org,bac-home.eu,bastion.redhat.demolab,ceph01.lab.seeweb,cephadmin.intel.demolab.com,cephnode1.intel.demolab.com,cephnode2.intel.demolab.com,cestay.localdomain,chhan-minishift,clientvm-sat-demo.wifi-bridge.intra,code.vm.bdm.scot,congruity.lab.ousted.org,dalebox.igou.systems,dell-pe,dell-r730-056.dsal.lab.eng.rdu2.redhat.com,dhcp153-75.rdu.redhat.com,dm1.heytate.com,edge-19.edge.lab.eng.rdu2.redhat.com,falcon5,fantastic.iot-playground.org,floating-ip-173.dsal.lab.eng.tlv2.redhat.com,fperalta-tvm001.gsslab.brq.redhat.com,fperalta-tvm003.gsslab.brq.redhat.com,gitlab-test-rhel-8.lan,gitlab.lab.seeweb,grafana.demo.kjz.dev,hypervisor.hattiesburg.home,identity.home.arpa,idm.alfslab.com,idm.lin.homelab.lan,idm.lp.int,idm01.ipa.yceconsulting.com,idmclient.lp.int,insights2.example.com,ip-11-22-33-130.prod.maskedadmins.com,ip-11-22-33-79.prod.maskedadmins.com,ip-11-22-33-8.prod.maskedadmins.com,ip-11-22-33-98.prod.maskedadmins.com,js-atower.example.com,jumphost.samsung.bos2.lab,jumphost2.westfordb.lab.eng.rdu2.redhat.com,k8s-etcd.rbpsiu.net,k8s-master.rbpsiu.net,k8s-worker1.rbpsiu.net,k8s-worker2.rbpsiu.net,kiwiirc.laptap.bdm.scot,kvm2.wisa.mylab,lab,lab-serverb.lab.example.com,laptoprhel8,laugharne.rhos.bigfiber.net,lm22-tablet.lab.lan,localhost,log.lab.kjz.dev,majesticp1g3.home,mikerhel8.mikeoso,mosuke5-station,neuralink,nevlnlap002.netone.local,njung.sel.csb,nuc1.local,onering.faett.lab,ossec.int.websinnit.com,p1gen3.localdomain,pahub.vm.bdm.scot,pbitcolo-build-04.permabit.com,pcprhel84.dytest123.com,photon.nrt.redhat.com,pihole.homelab.lan,pnjump.infra.pnhomelab.net,podman.rbpsiu.net,provisioner.westfordb.lab.eng.rdu2.redhat.com,prowl.redhat.demo,proxy,quayregistry.homelab.local,r1-provisioner.lab.eng.cert.redhat.com,r2-master-2,r2-master-3,r2-provisionhost,reporting.vm.bdm.scot,rhcsa-node02.hammer.lan,rhel-8-tower.hammer.lan,rhel2.alfslab.com,rhel8,rhel8-4-1,rhel8-insights-client.virbr0.mstipich,rhel8-jbuckley-com,rhel8.4.example.com,rhel8.5,rhel8.localdomain,rhel8.sbunciak.redhat.com,rhel8.vm.bdm.scot,rhel85-base.mihalabo.com,rhel85-demo.mihalabo.com,rhel85.dev.mac,rhel8gfs01.lab.kjz.dev,rhel8gfs02.lab.kjz.dev,rhel8omada,rhel8vm1.localdomain,rhelworkstation.localdomain,rhvmgr01.lab.local,rnix3,ryzen5.lab.home,saru.local.bytewise.my,sattest1.lp.int,saturnv-srv-local.lan,sefaz-ansible-ha-p01,sgchlvlrh8test01.homelabs.asia,sgchlvlrh8test02.homelabs.asia,sgchlvlrhansah01.homelabs.asia,sgchlvlrhanscon01.homelabs.asia,sgchlvlrhansdb01.homelabs.asia,shanemcd-execution-node-1.ansible.eng.rdu2.redhat.com,sql1,ssbastion.comm.ibm.gsc,test1.rhel8,testhost3.lab.asmlab.uk,testhost4.lab.asmlab.uk,tower.lab.local,tower.vm.bdm.scot,tower38,tower4.duendecillos.com,tower41,util.lab.kjz.dev,vault.lab.seeweb,vm-235-117.vmware.gsslab.pnq2.redhat.com,work.lab.kjz.dev"
  become: true
  gather_facts: false
  vars:
    insights_signature_exclude: /hosts,/vars/insights_signature
    insights_signature: !!binary |
      TFMwdExTMUNSVWRKVGlCUVIxQWdVMGxIVGtGVVZWSkZMUzB0TFMwS1ZtVnljMmx2YmpvZ1IyNTFV
      RWNnZGpFS0NtbFJTVlpCZDFWQldVaHBRaXR6ZG5jMU9FUXJhalZ3VGtGUmFXdDRaeTh2WmtaRFoz
      QXlTblIxVEd0UU5qQnNTa3BZYm1GU1JGTjVjVVYwU0ZSNlRGY0tOVlZSVlc5MWEyUmpVRFJVUlZn
      d01EaDFhRkJHUzFaSmVrdFVTR2RsYTFOaU1UUXlkMjlQYm5sR2VUUnpRbEJrZEZoaGREVlliWEp0
      VGxsR1EwaEVWZ28xYVhSdlNrcDBPVzg1UWtkQlJVaDVZMFJ3SzBoNVNqWXphM0paZVRGUk1rOXVU
      azF3VjJaSmNtYzJUakJXVTJoa1JtVk1lR0ppTjBaMlpFaEpjbFo2Q2pJNGFrdHhOemx1Tm13eUx6
      aDZZVkJSTDFkWVZIWkNaMDVhUkVWTFJ6TmhSSFl3WVRkbWIyUnlPRWhEZGxseE5tNUhNRkZOY1RO
      U1ZFOXBkbFZtTTFnS1JuQnlhVTh2TDNKSlRDOVlSelE1TTA1NGFWSjBRakVyZEhSUk0wZHNhM1ZE
      ZFVwck1EQkdaREp0ZDNZNFprRnZaR2xUUW5aelQydEpZekZyV25adFN3cEJjR3BEY1ZKMWVHaExU
      MDgzYWxZM1FYSnRTV0p6TkhobVJrUkJVMkZaV2t4R01VMHZhME42ZWs1d1MwTjFhbE5hVUUxRlVt
      WlhhV2RHVGpGMWRqRjNDalpQSzB0b1pTdFJVRU5hUm5CV1kwVndSbTFSTVdwcWFrOVFPV2haSzNW
      alZWSnhSVEkyTlhGTWRuWnFSWE4wUW5WQk4xQkZNRVZ3UkRsaU5VaFZSM1lLTkZKemJXc3pNbFpC
      Vnl0WE5IWk1VRWQwZG1sQ00wSXpUbE0wZUhCdVIzSmlObGs1Y1cwNFZuVTJSRUZIV2xOYWRsbFlk
      bWQwTm1WR2N6RTVTVFZZUWdvMGVtcFVSRUlyTW1sT2NrcE9jM2d5YURoU1VGVnJMMmhZUzFKMGEy
      WnZZMlpKZVRkcGNWY3hiMGRsTlZSMmFqTTFSbXRqUld0YU9VRnpSMjl6WXpWMENuUlZkVlZJWWpS
      ME5EVTFSSE5EWlZWc1ZEZFNOakJDTTB4d1Z6TmlTRTF0YzFCMEx6RktNRFEwYm1KS2RFTkhUM1Jy
      UVVWWVRsVTJlbGxUTDNBMFFqSUtaSFYxY2tZdlNHUnFWWFJNVDNSdlNFTnlZVWd2WkZwaFRVNTZk
      MVZpZUc1VFZXUkdZU3R6TTBaNFJHczFVVkU0VVRaMVVucFpRbWw0WkcxeWREZGpUQXBKYTA1NlEy
      aHBRMDlrY3owS1BVMVZOMk1LTFMwdExTMUZUa1FnVUVkUUlGTkpSMDVCVkZWU1JTMHRMUzB0Q2c9
      PQ==
  tasks:
    - name: run insights
      command: insights-client
      changed_when: false
